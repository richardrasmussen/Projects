<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Weather Maps - North America</title>
    
    <!-- Leaflet CSS - Use unpkg CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" 
          crossorigin="anonymous">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">üå§Ô∏è Interactive Weather Maps - North America</span>
            <div class="d-flex align-items-center">
                <span id="demoModeIndicator" class="badge bg-warning text-dark me-2 d-none">DEMO MODE</span>
                <span class="text-white small">Data from <a href="https://open-meteo.com/" target="_blank" class="text-white">Open-Meteo API</a> &amp; <a href="https://www.windy.com/" target="_blank" class="text-white">Windy</a></span>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Left Panel - Controls -->
            <div class="col-md-3 col-lg-2 bg-light p-3 control-panel">
                <h5>Controls</h5>
                
                <!-- Animated Overlay Toggle -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Display Mode</label>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="animatedOverlayToggle">
                        <label class="form-check-label" for="animatedOverlayToggle">
                            Animated Overlays
                        </label>
                    </div>
                </div>
                
                <!-- Data Mode Toggle -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Data Mode</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="dataMode" id="modeCurrent" value="current" checked>
                        <label class="btn btn-outline-primary btn-sm" for="modeCurrent">Current</label>
                        
                        <input type="radio" class="btn-check" name="dataMode" id="modeHistorical" value="historical">
                        <label class="btn btn-outline-primary btn-sm" for="modeHistorical">Historical</label>
                    </div>
                </div>

                <!-- Date/Time Selection -->
                <div class="mb-3" id="dateTimeSection">
                    <label for="dateInput" class="form-label fw-bold">Date</label>
                    <input type="date" class="form-control form-control-sm" id="dateInput">
                    
                    <label for="timeInput" class="form-label fw-bold mt-2">Hour (UTC)</label>
                    <select class="form-select form-select-sm" id="timeInput">
                        <option value="0">00:00</option>
                        <option value="1">01:00</option>
                        <option value="2">02:00</option>
                        <option value="3">03:00</option>
                        <option value="4">04:00</option>
                        <option value="5">05:00</option>
                        <option value="6">06:00</option>
                        <option value="7">07:00</option>
                        <option value="8">08:00</option>
                        <option value="9">09:00</option>
                        <option value="10">10:00</option>
                        <option value="11">11:00</option>
                        <option value="12" selected>12:00</option>
                        <option value="13">13:00</option>
                        <option value="14">14:00</option>
                        <option value="15">15:00</option>
                        <option value="16">16:00</option>
                        <option value="17">17:00</option>
                        <option value="18">18:00</option>
                        <option value="19">19:00</option>
                        <option value="20">20:00</option>
                        <option value="21">21:00</option>
                        <option value="22">22:00</option>
                        <option value="23">23:00</option>
                    </select>
                </div>

                <!-- Weather Parameter Selection -->
                <div class="mb-3">
                    <label for="weatherParam" class="form-label fw-bold">Weather Parameter</label>
                    <select class="form-select form-select-sm" id="weatherParam">
                        <option value="temperature_2m">Temperature (2m)</option>
                        <option value="precipitation">Precipitation</option>
                        <option value="rain">Rain</option>
                        <option value="snowfall">Snowfall</option>
                        <option value="wind_speed_10m">Wind Speed</option>
                        <option value="wind_direction_10m">Wind Direction</option>
                        <option value="cloud_cover">Cloud Cover</option>
                        <option value="pressure_msl">Pressure (Sea Level)</option>
                        <option value="relative_humidity_2m">Relative Humidity</option>
                        <option value="visibility">Visibility</option>
                        <option value="weather_code">Weather Code</option>
                        <option value="dew_point_2m">Dew Point</option>
                        <option value="apparent_temperature">Apparent Temperature</option>
                    </select>
                </div>

                <!-- Units Toggle -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Units</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="units" id="unitsMetric" value="metric" checked>
                        <label class="btn btn-outline-secondary btn-sm" for="unitsMetric">Metric</label>
                        
                        <input type="radio" class="btn-check" name="units" id="unitsImperial" value="imperial">
                        <label class="btn btn-outline-secondary btn-sm" for="unitsImperial">Imperial</label>
                    </div>
                </div>

                <!-- Animation Controls (visible only when animated overlays enabled) -->
                <div id="animationControls" class="mb-3 d-none">
                    <label class="form-label fw-bold">Animation Layer</label>
                    <select class="form-select form-select-sm mb-2" id="windyLayer">
                        <option value="wind">Wind</option>
                        <option value="temp">Temperature</option>
                        <option value="rain">Rain/Precipitation</option>
                        <option value="clouds">Clouds</option>
                        <option value="pressure">Pressure</option>
                        <option value="waves">Waves</option>
                    </select>
                    
                    <div class="btn-group w-100 mb-2" role="group">
                        <button type="button" class="btn btn-sm btn-outline-primary" id="playPauseBtn">
                            ‚ñ∂ Play
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-primary" id="stopAnimationBtn">
                            ‚èπ Stop
                        </button>
                    </div>
                    
                    <small class="text-muted d-block">Animated overlays show forecast data</small>
                </div>

                <!-- Update Button -->
                <button id="updateMap" class="btn btn-primary w-100 mb-2">
                    <span id="updateButtonText">Update Map</span>
                    <span id="updateSpinner" class="spinner-border spinner-border-sm ms-2 d-none"></span>
                </button>

                <!-- Clear Markers Button -->
                <button id="clearMarkers" class="btn btn-secondary w-100 btn-sm">Clear Markers</button>
            </div>

            <!-- Main Content Area -->
            <div class="col-md-9 col-lg-10 p-0">
                <!-- Map Container - Leaflet (Static Mode) -->
                <div id="map"></div>
                
                <!-- Windy Map Container (Animated Mode) -->
                <div id="windyMap" class="d-none"></div>

                <!-- Data Panel -->
                <div class="data-panel" id="dataPanel">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Weather Data</h6>
                        <button class="btn btn-sm btn-outline-secondary" id="closeDataPanel">&times;</button>
                    </div>
                    <div id="dataPanelContent">
                        <p class="text-muted small">Click on the map to view weather data for a specific location.</p>
                    </div>
                </div>

                <!-- Legend -->
                <div class="legend" id="legend">
                    <h6 class="mb-2">Legend</h6>
                    <div id="legendContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay d-none">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading weather data...</p>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
            crossorigin="anonymous"></script>
    
    <!-- Windy API - includes its own map engine -->
    <script src="https://api.windy.com/assets/map-forecast/libBoot.js"></script>
    
    <!-- Custom JS -->
    <script src="map.js"></script>
</body>
</html>
